<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶è¨ˆç°¿ç®¡ç†</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
</head>
<body>

<form class="w-75 mx-auto">  
    <p class="mt-3">å¹´æœˆ</p>
    <div class="form-row">
        <div class="col">
            <select class="form-control" name="year"></select>
        </div>
        <div class="col">
            <select class="form-control" name="month"></select>
        </div>
    </div>
    
    <p class="mt-3">è²»ç›®</p>
    <div>
        <select class="form-control w-100" name="himo"></select>
    </div>
    
    <p class="mt-3">é‡‘é¡</p>
    <div class="input-group">
        <input class="form-control w-100" name="udetate" required>
        <div class="input-group-append">
            <span class="input-group-text">å††</span>
        </div>
    </div>
    
    <p class="mt-3">ãƒ¡ãƒ¢</p>
    <div>
        <input class="form-control w-100" name="memo">
    </div>
    <input type="submit" class="mt-4 btn btn-primary" value="é€ä¿¡">
</form>

<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
<script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

<script>$(function () {
    const yearSelect = $('select[name="year"]');
    const monthSelect = $('select[name="month"]');
    const himoSelect = $('select[name="himo"]');
    const today = new Date();
    const currentYear = today.getFullYear();
    const currentMonth = today.getMonth() + 1;

    // å¹´ã®é¸æŠè‚¢ç”Ÿæˆï¼ˆä»Šå¹´ã€œ5å¹´å¾Œï¼‰
    let yearOptions = '';
    for (let i = 0; i < 6; i++) {
        const year = currentYear + i;
        yearOptions += `<option value="${year}">${year}å¹´</option>`;
    }
    yearSelect.html(yearOptions).val(currentYear);

    // æœˆã®é¸æŠè‚¢ç”Ÿæˆ
    let monthOptions = '';
    for (let i = 1; i <= 12; i++) {
        monthOptions += `<option value="${i}">${i}æœˆ</option>`;
    }
    monthSelect.html(monthOptions).val(currentMonth + 1);

    // ===== ğŸ‘‡ ã“ã“ã§é–¢æ•°åŒ– =====
    function fetchHimoList() {
        const url = "https://script.google.com/macros/s/AKfycbzzVKYEbfo3N8IbPviYcK3OGTq3mihLLmL5B-VRGIx7AvAUsfJsd1-YEZFQ1S8MVAuVdw/exec";
        fetch(url)
            .then(res => res.json())
            .then(data => {
                let options = '';
                data.forEach(himo => {
                    options += `<option value="${himo}">${himo}</option>`;
                });
                options += `<option value="åå…¥">åå…¥</option>`;
                himoSelect.html(options);
            })
            .catch(err => {
                console.error("è²»ç›®å–å¾—å¤±æ•—:", err);
            });
    }

    // åˆå›ã®è²»ç›®å–å¾—
    fetchHimoList();

    // å¹´é¸æŠæ™‚ã®è²»ç›®ãƒªã‚¹ãƒˆå†å–å¾—
    yearSelect.on('change', function () {
        fetchHimoList();
    });

    // LIFFåˆæœŸåŒ–
    const liffId = "2003899256-PBMA9YXX";
    liff.init({ liffId })
        .then(() => {
            // LIFF åˆæœŸåŒ–æˆåŠŸ
        })
        .catch((err) => {
            console.error("LIFFåˆæœŸåŒ–å¤±æ•—:", err);
        });

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å‡¦ç†
    $('form').submit(function () {
        const year = yearSelect.val();
        const month = monthSelect.val();
        const himo = himoSelect.val();
        const udetate = $('input[name="udetate"]').val();
        const memo = $('input[name="memo"]').val();
        const msg = `${year}å¹´${month}æœˆ\n${himo}\n${udetate}å††\n${memo}`;
        sendText(msg);
        return false;
    });

    // LINEãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
    function sendText(text) {
        liff.sendMessages([{
            type: 'text',
            text: text
        }]).then(() => {
            liff.closeWindow();
        }).catch((error) => {
            alert('é€ä¿¡å¤±æ•—: ' + error);
        });
    }
});
</script>

</body>
</html>

